#include <iostream>
#include <string>
#include <algorithm>


bool GOCalibration2023PbPb_check(std::string runNumberorMC, const int index){

  if( runNumberorMC.compare("MC") == 0 ){
     if(index == 0) std::cout << "Running using centrality calibration table from MC" << std::endl; 
     return true;
  }else if ( runNumberorMC.compare("Run374354") == 0 ){
     if(index == 0) std::cout << "Running using centrality calibration table from Run 374354" << std::endl;
     return true;
  }else if ( runNumberorMC.compare("Run374719") == 0 ){
     if(index == 0) std::cout << "Running using centrality calibration table from Run 374719" << std::endl;
     return true;
  }else if ( runNumberorMC.compare("Run374810") == 0 ){
     if(index == 0) std::cout << "Running using centrality calibration table from Run 374810" << std::endl;
     return true;
  }else {
     if(index == 0) std::cout << "Error! The calibration table is not implemented for this. Please try 'MC', 'Run374354', 'Run374719', or 'Run374810'" << std::endl;
     return false;
  } 

}

int GOCalibration2023PbPb_getHiBinFromhiHF(const float hiHF, std::string runNumberorMC, const int index){

  bool check = GOCalibration2023PbPb_check(runNumberorMC, index);
  if(check == false) return -1;

  const int nBins = 200;
  const float binTableMC[nBins+1] = {0, 12.1384, 13.0446, 13.8955, 14.7667, 15.602, 16.5115, 17.3905, 18.3111, 19.1846, 20.1476, 21.1091, 22.0792, 23.1334, 24.2665, 25.3407, 26.4548, 27.5858, 28.834, 30.0945, 31.4178, 32.7356, 34.1572, 35.7776, 37.3834, 38.9727, 40.5603, 42.3307, 44.1125, 46.1516, 48.1373, 50.3485, 52.4973, 54.8182, 57.3321, 59.8994, 62.4678, 65.2314, 68.163, 71.3275, 74.2499, 77.5898, 80.9105, 84.3979, 88.0014, 91.6443, 95.5953, 99.5969, 103.978, 108.325, 112.754, 117.553, 122.733, 127.796, 133.166, 138.814, 144.246, 150.164, 156.175, 162.337, 169.064, 175.322, 182.549, 190.096, 197.784, 205.519, 213.472, 221.946, 230.183, 238.984, 247.818, 256.869, 266.613, 277.026, 287.906, 298.221, 308.835, 319.589, 331.121, 342.755, 354.336, 366.378, 378.89, 391.629, 404.912, 418.939, 432.374, 446.098, 459.993, 474.341, 488.969, 505.522, 520.94, 537.465, 554.02, 571.095, 588.226, 606.543, 625.223, 643.385, 662.999, 682.779, 702.897, 723.637, 745.966, 767.975, 790.23, 812.799, 835.946, 859.036, 881.055, 906.662, 930.825, 955.64, 982.938, 1007.11, 1032.27, 1058.66, 1085.24, 1114.05, 1142.78, 1171.79, 1201.65, 1230.12, 1261.71, 1293.46, 1325.72, 1358.95, 1391.79, 1425.6, 1459.05, 1494.67, 1531.89, 1565.84, 1604.08, 1640.78, 1679.26, 1719.68, 1758.23, 1797.89, 1835.66, 1876.85, 1917.94, 1959.5, 2003.8, 2047.67, 2092.87, 2144.97, 2191.05, 2236.87, 2284.6, 2333.95, 2383.19, 2434.19, 2485.93, 2536.4, 2589.7, 2644.88, 2697.56, 2751.27, 2805.32, 2862.51, 2920.73, 2979.95, 3040.08, 3101.97, 3163.75, 3228.3, 3293.03, 3354.97, 3425.19, 3491.18, 3566.67, 3640.54, 3714.76, 3789.27, 3860.28, 3934.71, 4011.14, 4096.71, 4181.06, 4258.3, 4347.51, 4437.08, 4527.68, 4610.4, 4703.06, 4796.91, 4902.53, 5001.15, 5098.65, 5201.88, 5302.97, 5415.24, 5525.27, 5633.25, 5754.55, 5884.82, 6026.2, 6230.63, 7150.02};
  const float binTablerun374354[nBins+1] = {0, 10.3116, 11.0141, 11.6875, 12.3964, 13.0923, 13.8143, 14.5413, 15.301, 16.0383, 16.8102, 17.5991, 18.4262, 19.2787, 20.1888, 21.1088, 22.034, 22.9952, 23.967, 25.039, 26.1121, 27.2358, 28.3541, 29.6364, 30.9602, 32.3329, 33.7229, 35.0684, 36.5625, 38.0891, 39.8103, 41.5127, 43.3523, 45.1595, 47.1145, 49.271, 51.4506, 53.6149, 55.9787, 58.4351, 61.0758, 63.5983, 66.3839, 69.27, 72.1743, 75.2412, 78.3156, 81.6464, 84.9985, 88.6607, 92.3563, 96.1338, 100.19, 104.183, 108.346, 112.636, 117.086, 121.685, 126.489, 131.559, 136.924, 142.388, 147.942, 153.754, 159.623, 165.837, 172.166, 178.779, 185.78, 192.771, 199.965, 207.414, 215.256, 223.439, 231.473, 240.066, 248.865, 257.928, 267.275, 276.874, 286.425, 296.663, 307.263, 317.992, 328.953, 340.433, 351.877, 363.711, 375.968, 388.593, 401.158, 414.25, 427.925, 441.72, 456.091, 471.114, 486.077, 501.371, 517.06, 533.479, 549.778, 566.643, 583.684, 601.449, 619.414, 637.487, 656.093, 674.364, 693.707, 713.595, 733.751, 754.812, 775.664, 797.154, 819.595, 841.884, 864.915, 888.199, 912.056, 936.288, 960.808, 986.464, 1011.77, 1037.47, 1063.93, 1091.09, 1118.78, 1146.05, 1174.22, 1203.41, 1232.47, 1263.71, 1293.42, 1324.13, 1355.79, 1387.15, 1419.45, 1452.85, 1485.86, 1520.48, 1554.48, 1589.98, 1625.45, 1661.22, 1697.73, 1734.27, 1772.86, 1811.66, 1851.61, 1892.72, 1934.39, 1975.11, 2015.97, 2059.38, 2103.43, 2148.03, 2193.88, 2240.66, 2287.49, 2334.74, 2383.19, 2431.66, 2481.49, 2531.77, 2582.55, 2634.59, 2689.82, 2743.33, 2798.18, 2856.76, 2914.12, 2974.3, 3034.35, 3096.1, 3159.25, 3222.37, 3285.67, 3350.59, 3417.31, 3486.11, 3556.16, 3627.68, 3698.93, 3773.43, 3849.72, 3926.67, 4006.28, 4087.57, 4172.45, 4257.29, 4342.52, 4430.82, 4523.22, 4616.67, 4715.28, 4819.95, 4927.83, 5039.09, 5156.88, 5302.01, 8120.53};
  const float binTablerun374719[nBins+1] = {0, 10.3134, 11.0148, 11.6881, 12.3999, 13.0965, 13.8181, 14.5444, 15.3029, 16.04, 16.8139, 17.6162, 18.4345, 19.2949, 20.2007, 21.1205, 22.0489, 23.0168, 23.9796, 25.0543, 26.1307, 27.2644, 28.38, 29.6596, 30.9875, 32.3619, 33.7528, 35.091, 36.5924, 38.1574, 39.8434, 41.545, 43.4126, 45.228, 47.182, 49.3166, 51.5236, 53.686, 56.068, 58.5474, 61.1423, 63.6744, 66.4951, 69.3742, 72.2955, 75.3394, 78.4957, 81.778, 85.1497, 88.8327, 92.5354, 96.3018, 100.379, 104.458, 108.679, 113.021, 117.607, 122.276, 127.183, 132.196, 137.424, 142.844, 148.477, 154.322, 160.306, 166.452, 172.904, 179.511, 186.455, 193.574, 200.873, 208.427, 216.234, 224.3, 232.497, 241.056, 249.893, 258.947, 268.256, 277.892, 287.685, 297.83, 308.343, 319.06, 330.129, 341.39, 352.808, 364.702, 376.9, 389.647, 402.429, 415.619, 428.956, 442.822, 456.97, 471.576, 486.762, 502.004, 517.815, 533.806, 550.073, 566.743, 583.852, 601.37, 619.128, 637.308, 655.475, 674.415, 693.888, 713.717, 733.561, 754.271, 775.241, 796.521, 818.282, 840.312, 862.885, 886.164, 909.449, 933.707, 958.179, 983.289, 1008.82, 1034.74, 1061.08, 1087.68, 1115.05, 1142.94, 1171.22, 1199.9, 1229.05, 1258.99, 1289.03, 1319.78, 1351.13, 1383.27, 1415.87, 1448.65, 1482.64, 1517.04, 1551.79, 1586.88, 1622.85, 1659.5, 1696.63, 1734.24, 1772.57, 1811.93, 1851.72, 1891.99, 1933.2, 1975.05, 2017.38, 2060.19, 2104.04, 2148.83, 2193.99, 2239.52, 2285.63, 2333.49, 2381.43, 2430.17, 2479.23, 2530.1, 2582.22, 2634.59, 2689.06, 2743.65, 2799.22, 2855.8, 2913.29, 2971.78, 3031.34, 3092.71, 3154.17, 3217.16, 3282.31, 3347.8, 3414.11, 3482.18, 3551.62, 3622.82, 3694.11, 3768.71, 3844.68, 3922.3, 4002.53, 4084.63, 4168.02, 4252.97, 4341.56, 4433.2, 4526.23, 4620.37, 4720.01, 4821.03, 4925.68, 5037.72, 5157.38, 5302.31, 8118.79};
  const float binTablerun374810[nBins+1] = {0, 10.3138, 11.0168, 11.6887, 12.4017, 13.1032, 13.8242, 14.5525, 15.3078, 16.0456, 16.8228, 17.6194, 18.4478, 19.3026, 20.2202, 21.139, 22.0618, 23.0339, 24.0013, 25.0864, 26.1527, 27.2967, 28.4017, 29.7021, 31.0245, 32.4019, 33.79, 35.1153, 36.6736, 38.2086, 39.8958, 41.6293, 43.4779, 45.2889, 47.2859, 49.4019, 51.6075, 53.8018, 56.1779, 58.6657, 61.2747, 63.7784, 66.6248, 69.5158, 72.4441, 75.473, 78.6523, 81.9641, 85.3832, 89.0336, 92.7743, 96.5079, 100.608, 104.679, 108.929, 113.27, 117.753, 122.457, 127.315, 132.375, 137.611, 143.061, 148.678, 154.494, 160.444, 166.623, 173.032, 179.723, 186.614, 193.66, 200.976, 208.445, 216.178, 224.197, 232.403, 240.907, 249.687, 258.638, 267.878, 277.539, 287.46, 297.53, 307.991, 318.696, 329.794, 341.106, 352.646, 364.556, 376.956, 389.394, 402.304, 415.529, 428.996, 442.862, 456.913, 471.415, 486.156, 501.403, 516.918, 532.781, 549.048, 565.805, 582.746, 600.083, 618.078, 636.074, 654.746, 673.621, 692.705, 712.421, 732.663, 753.33, 774.137, 795.56, 817.378, 839.702, 862.455, 885.426, 908.957, 933.159, 957.612, 982.447, 1007.92, 1033.87, 1060.2, 1086.95, 1114.21, 1141.93, 1170.01, 1198.91, 1228.24, 1258.1, 1288.38, 1319.24, 1350.46, 1382.19, 1414.78, 1447.64, 1481.48, 1515.6, 1550.36, 1585.85, 1621.66, 1658.02, 1694.95, 1732.68, 1771.12, 1809.92, 1849.18, 1889.56, 1930.65, 1971.91, 2014.56, 2057.92, 2101.59, 2145.97, 2191.27, 2237.19, 2284.45, 2332.04, 2380.21, 2429.72, 2479.67, 2530.08, 2581.73, 2634.79, 2688.9, 2743.8, 2799.8, 2856.36, 2913.74, 2972.23, 3031.93, 3092.5, 3153.88, 3216.64, 3281.17, 3347.2, 3414.3, 3482.56, 3551.38, 3623.07, 3696, 3770.57, 3847.37, 3925.28, 4004.79, 4087.15, 4170.47, 4256.05, 4343.81, 4434.32, 4526.95, 4623.36, 4722.74, 4823.81, 4929.64, 5040.23, 5159.99, 5304.28, 8171.19};


  int binPos = -1;
  float binTable[nBins+1];
  if(runNumberorMC.compare("MC") == 0){copy(binTableMC, binTableMC+nBins, binTable);}
  else if( runNumberorMC.compare("Run374354") == 0 ){copy(binTablerun374354, binTablerun374354+nBins, binTable);}
  else if( runNumberorMC.compare("Run374719") == 0 ){copy(binTablerun374719, binTablerun374719+nBins, binTable);}
  else if( runNumberorMC.compare("Run374810") == 0 ){copy(binTablerun374810, binTablerun374810+nBins, binTable);}
  else{ cout << "" << endl; return 0; }
  for(int i = 0; i < nBins; ++i){
    if(hiHF >= binTable[i] && hiHF < binTable[i+1]){
      binPos = i;
      break;
    }
  }

  binPos = nBins - 1 - binPos;

  return (int)(200*((float)binPos)/((float)nBins));
}
